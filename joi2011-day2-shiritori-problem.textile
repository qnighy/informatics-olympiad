---
layout: default
title: "Shiritori(しりとり) - joi2011-day2"
source: "第10回日本情報オリンピック 日本代表選手選考会"
source_url: "http://www.ioi-jp.org/camp/2011/2011-sp-tasks/index.html"
timelimit: "5秒"
memlimit: "64MB"
---

JOI 国では，<var>100</var> 種類の文字が使われている．これらの文字は，コンピュータ上では直接表すことが難しいので，代わりに以下の表記が用いられる．

<pre>
00 01 02 03 04 05 06 07 08 09
10 11 12 13 14 15 16 17 18 19
20 21 22 23 24 25 26 27 28 29
30 31 32 33 34 35 36 37 38 39
40 41 42 43 44 45 46 47 48 49
50 51 52 53 54 55 56 57 58 59
60 61 62 63 64 65 66 67 68 69
70 71 72 73 74 75 76 77 78 79
80 81 82 83 84 85 86 87 88 89
90 91 92 93 94 95 96 97 98 99
</pre>

すなわち，数字 <var>2</var> つによる <var>10 \times 10</var> 通りで表される．JOI 国の辞書では，この表によって定まる文字の順番によって単語を並べている．表の上の行にある文字がより早く，同じ行の文字ではより左の文字が早い．

さて，JOI 国では今，しりとりが一大ブームである．しりとりとは，参加者が順番に，前の人が言った単語の最後の文字から始まる単語を言っていくゲームである．一度言われた単語を使うことはできない．

ある日，あなたは友達と「<var>5</var> しりとり」で遊んでいた．「<var>5</var> しりとり」では，通常のしりとりのルールに加え，用いる単語はすべて <var>5</var> 文字でなければならない．あなたは「<var>5</var> しりとり」で言われた <var>N</var> 個の単語のリストをコンピュータに記録していたのだが，誤って並べ替えてしまった．そこで，単語のリストから「<var>5</var> しりとり」の様子を復元したい．

h2. 課題

単語のリストが与えられたとき，「<var>5</var> しりとり」の様子を復元するプログラムを作成せよ．

h2. 制限

| <var>1 \leq N \leq 500\,000</var> | 単語の個数 |

h2. 入力

標準入力から以下の入力を読み込め.

* <var>1</var> 行目には整数 <var>N</var> が書かれており，単語の個数を表す．
* 続く <var>N 行には各単語が <var>1</var> 行に <var>1</var> つずつ書かれている．各単語は数字ちょうど <var>10</var> 個からなる文字列で表される．単語は辞書に掲載されている順に入力に書かれており，すべての単語は異なる．

h2. 出力

与えられた <var>N</var> 個の単語を用いた「<var>5</var> しりとり」が不可能である場合，impossible と <var>1</var> 行に出力せよ．

「<var>5</var> しりとり」が可能である場合，用いられる <var>N</var> 個の単語を <var>1</var> 行 <var>1</var> つずつ出力せよ．可能な「<var>5</var> しりとり」が複数考えられるときは，以下の条件を満たすものを選べ．

* <var>1</var> 番目の単語が辞書に最も早く掲載されているもの
* 以上で定まらない場合は，<var>2</var> 番目の単語が辞書に最も早く掲載されているもの．
* :
* :
* 以上で定まらない場合は，<var>N</var> 番目の単語が辞書に最も早く掲載されているもの．

h2. 採点基準

* 採点用データのうち，配点の <var>65%</var> 分については，現れる文字は <var>00</var> から <var>19</var> までの <var>20</var> 種類に限られる．
* 採点用データのうち，配点の <var>65%</var> 分については，<var>N \leq 1\,000</var> を満たす．
* 採点用データのうち，配点の <var>40%</var> 分については，これら <var>2</var> つの条件の両方を満たす．
* 採点用データのうち，配点の <var>90%</var> 分については，これら <var>2</var> つの条件の少なくとも一方を満たす．

h2. 入出力の例

|_. 入力例 1|_. 出力例 1|
|<samp>5
0000010201
0102030403
0104050603
0206070801
0308090002</samp>|<samp>0000010201
0102030403
0308090002
0206070801
0104050603</samp>|

この例では，以下の <var>2</var> 通りの「<var>5</var> しりとり」が考えられる.

* 00000102<strong>01</strong> → <strong>01</strong>020304<strong>03</strong> → <strong>03</strong>080900<strong>02</strong> → <strong>02</strong>060708<strong>01</strong> → <strong>01</strong>04050603
* 00000102<strong>01</strong> → <strong>01</strong>040506<strong>03</strong> → <strong>03</strong>080900<strong>02</strong> → <strong>02</strong>060708<strong>01</strong> → <strong>01</strong>02030403

<var>1</var> 番目の単語は同じであり，<var>2</var> 番目の単語が辞書に掲載されている順番を比較して，前者を出力する.

|_. 入力例 2|_. 出力例 2|
|<samp>4
9600000098
9700000099
9800000099
9900000098</samp>|<samp>impossible</samp>|

この例では，可能な「<var>5</var> しりとり」は存在しない．

|_. 入力例 3|_. 出力例 3|
|<samp>12
0114090401
0214051905
0304141219
0510031717
0703050011
1102190101
1108040907
1110090702
1313071203
1707120711
1902090011
1909121313</samp>|<samp>1909121313
1313071203
0304141219
1902090011
1108040907
0703050011
1110090702
0214051905
0510031717
1707120711
1102190101
0114090401</samp>|

